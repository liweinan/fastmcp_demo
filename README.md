# FastMCP æç®€ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº FastMCP çš„æç®€ç¤ºä¾‹ï¼ŒåŒ…å«ç®€å•çš„è®¡ç®—å·¥å…·å’Œæœ¬åœ°éƒ¨ç½²çš„å°å‹è¯­è¨€æ¨¡å‹ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– æœ¬åœ°éƒ¨ç½²çš„ Qwen2-1.5B è¯­è¨€æ¨¡å‹
- ğŸ› ï¸ ç®€å•çš„æ•°å­¦è®¡ç®—å·¥å…·ï¼ˆåŠ æ³•ã€ä¹˜æ³•ã€è¡¨è¾¾å¼è®¡ç®—ï¼‰
- ğŸ³ Docker å®¹å™¨åŒ–éƒ¨ç½²
- ğŸŒ HTTP API æ¥å£ï¼Œæ”¯æŒ curl äº¤äº’
- âš¡ åŸºäº llama.cpp çš„ CPU æ¨ç†

## å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½æ¨¡å‹

é¦–å…ˆéœ€è¦æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p models

# ä¸‹è½½ Qwen2-1.5B æ¨¡å‹ï¼ˆçº¦1.2GBï¼‰
wget -O models/qwen2-1_5b-instruct-q4_k_m.gguf \
  https://huggingface.co/Qwen/Qwen2-1.5B-Instruct-GGUF/resolve/main/qwen2-1_5b-instruct-q4_k_m.gguf
```

æˆ–è€…ä½¿ç”¨ huggingface-cliï¼š

```bash
# å®‰è£… huggingface-cli
pip install huggingface_hub

# ä¸‹è½½æ¨¡å‹
huggingface-cli download Qwen/Qwen2-1.5B-Instruct-GGUF qwen2-1_5b-instruct-q4_k_m.gguf --local-dir ./models
```

### 2. æ„å»ºå’Œå¯åŠ¨

#### æ— ä»£ç†ç¯å¢ƒ
```bash
# æ„å»º Docker é•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up
```

#### ä¼ä¸šä»£ç†ç¯å¢ƒ
å¦‚æœä½ åœ¨ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­ï¼Œéœ€è¦é…ç½®ä»£ç†ï¼š

```bash
# è®¾ç½®ä»£ç†ç¯å¢ƒå˜é‡
export http_proxy=http://your-proxy:port
export https_proxy=http://your-proxy:port
export no_proxy=localhost,127.0.0.1

# æ„å»º Docker é•œåƒï¼ˆä¼ é€’ä»£ç†å‚æ•°ï¼‰
docker-compose build --build-arg http_proxy=$http_proxy --build-arg https_proxy=$https_proxy --build-arg no_proxy=$no_proxy

# å¯åŠ¨æœåŠ¡
docker-compose up
```

**æ³¨æ„**: é¡¹ç›®åŒ…å«è‡ªåŠ¨ä»£ç†é…ç½®è„šæœ¬ `install.sh`ï¼Œä¼šè‡ªåŠ¨å¤„ç†å®¹å™¨å†…éƒ¨çš„ä»£ç†è®¾ç½®ã€‚

æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ã€‚

### 3. æµ‹è¯•æ¥å£

#### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/health
```
**é¢„æœŸè¾“å‡º**:
```json
{"mode":"mock","model_loaded":true,"status":"healthy"}
```

#### æŸ¥çœ‹å¯ç”¨å·¥å…·
```bash
curl http://localhost:8000/tools
```
**é¢„æœŸè¾“å‡º**:
```json
{
  "tools": {
    "add": {"description": "ä¸¤æ•°ç›¸åŠ ", "name": "add", "parameters": {...}},
    "multiply": {"description": "ä¸¤æ•°ç›¸ä¹˜", "name": "multiply", "parameters": {...}},
    "calculate": {"description": "è®¡ç®—ç®€å•æ•°å­¦è¡¨è¾¾å¼", "name": "calculate", "parameters": {...}}
  }
}
```

#### èŠå¤©æµ‹è¯•

**æ³¨æ„**: å¦‚æœä¸­æ–‡æ˜¾ç¤ºä¸º Unicode è½¬ä¹‰å­—ç¬¦ï¼ˆå¦‚ `\u6211`ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `jq` æˆ– `python3 -m json.tool` æ¥æ­£ç¡®æ˜¾ç¤ºï¼š

```bash
# ç®€å•åŠ æ³•
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®¡ç®— 5 + 3"}' | jq .
# é¢„æœŸè¾“å‡º:
# {
#   "response": "è®¡ç®—ç»“æœ: 8",
#   "tools_available": ["add", "multiply", "calculate"]
# }

# ä¹˜æ³•è¿ç®—
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®¡ç®— 4 * 7"}' | jq .
# é¢„æœŸè¾“å‡º:
# {
#   "response": "è®¡ç®—ç»“æœ: 28", 
#   "tools_available": ["add", "multiply", "calculate"]
# }

# è¡¨è¾¾å¼è®¡ç®—
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®¡ç®— 2+3*4"}' | jq .
# é¢„æœŸè¾“å‡º:
# {
#   "response": "è®¡ç®—ç»“æœ: 5",
#   "tools_available": ["add", "multiply", "calculate"]
# }

# éè®¡ç®—æ¶ˆæ¯
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"}' | jq .
# é¢„æœŸè¾“å‡º:
# {
#   "response": "æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯: ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿã€‚è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„AIå›å¤ã€‚",
#   "tools_available": ["add", "multiply", "calculate"]
# }

# è‹±æ–‡æ¶ˆæ¯
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "tell me todays date"}' | jq .
# é¢„æœŸè¾“å‡º:
# {
#   "response": "æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯: tell me todays dateã€‚è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„AIå›å¤ã€‚",
#   "tools_available": ["add", "multiply", "calculate"]
# }
```

**æ›¿ä»£æ–¹æ¡ˆ**ï¼ˆå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£… `jq`ï¼‰ï¼š
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "è®¡ç®— 5 + 3"}' | python3 -m json.tool
```

## Project Architecture

### ğŸ” æ¶æ„å…³ç³»

```
Flask HTTP Server â†’ llama-cpp-python â†’ Qwen2 Model
       â†“
   FastMCP Server â†’ Tool Execution Layer
```

**å…³é”®è¯´æ˜**ï¼š
- Flask ç›´æ¥è°ƒç”¨ llama-cpp-python è¿›è¡Œ LLM æ¨ç†
- FastMCP åªè´Ÿè´£å·¥å…·æ³¨å†Œå’Œæ‰§è¡Œï¼Œä¸å‚ä¸ LLM è°ƒç”¨
- LLM å’Œ FastMCP æ˜¯å¹³è¡Œå…³ç³»ï¼Œéƒ½é€šè¿‡ Flask åè°ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FastMCP Demo Architecture                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User (curl)   â”‚    â”‚   Docker Host   â”‚    â”‚  GitHub Repo    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ curl POST       â”‚    â”‚ ./models/       â”‚    â”‚ fastmcp_demo/   â”‚
â”‚ /chat           â”‚    â”‚ â”œâ”€â”€ qwen2-*.ggufâ”‚    â”‚ â”œâ”€â”€ server.py   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ â”œâ”€â”€ tools.py    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”œâ”€â”€ Dockerfile  â”‚
         â”‚                       â”‚            â”‚ â”œâ”€â”€ docker-     â”‚
         â”‚                       â”‚            â”‚ â”‚   compose.yml â”‚
         â”‚                       â”‚            â”‚ â””â”€â”€ README.md   â”‚
         â”‚                       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                     â”‚
         â”‚                       â”‚                     â”‚ git clone
         â”‚                       â”‚                     â”‚
         â–¼                       â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Container                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Flask HTTP    â”‚    â”‚   llama-cpp-    â”‚                   â”‚
â”‚  â”‚   API Server    â”‚    â”‚   python        â”‚                   â”‚
â”‚  â”‚   (Port 8000)   â”‚    â”‚                 â”‚                   â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                   â”‚
â”‚  â”‚ /health         â”‚    â”‚ CPU Inference   â”‚                   â”‚
â”‚  â”‚ /chat           â”‚    â”‚ n_threads=4     â”‚                   â”‚
â”‚  â”‚ /tools          â”‚    â”‚ n_ctx=2048      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                       â”‚                           â”‚
â”‚           â”‚                       â”‚                           â”‚
â”‚           â–¼                       â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   FastMCP       â”‚    â”‚   Qwen2-1.5B    â”‚                   â”‚
â”‚  â”‚   Server        â”‚    â”‚   Model         â”‚                   â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                   â”‚
â”‚  â”‚ Tool Registry   â”‚    â”‚ GGUF Format     â”‚                   â”‚
â”‚  â”‚ Tool Calling    â”‚    â”‚ ~1.2GB          â”‚                   â”‚
â”‚  â”‚ MCP Protocol    â”‚    â”‚ Volume Mount    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                       â”‚                           â”‚
â”‚           â”‚                       â”‚                           â”‚
â”‚           â–¼                       â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Tool Execution Layer                       â”‚  â”‚
â”‚  â”‚  (add, multiply, calculate functions)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Data Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚User Req â”‚â”€â”€â”€â–¶â”‚HTTP API â”‚â”€â”€â”€â–¶â”‚LLM Infr â”‚â”€â”€â”€â–¶â”‚MCP Tool â”‚â”€â”€â”€â–¶â”‚Tool Execâ”‚
â”‚"25+17"  â”‚    â”‚Flask    â”‚    â”‚Qwen2    â”‚    â”‚Call     â”‚    â”‚add()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚              â”‚
     â–¼              â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Response â”‚â—€â”€â”€â”€â”‚JSON Respâ”‚â—€â”€â”€â”€â”‚Tool Res â”‚â—€â”€â”€â”€â”‚MCP Exec â”‚â—€â”€â”€â”€â”‚Calc Res â”‚
â”‚"42"     â”‚    â”‚Format   â”‚    â”‚Parse    â”‚    â”‚FastMCP  â”‚    â”‚42       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®ç»“æ„

```
fastmcp_demo/
â”œâ”€â”€ Dockerfile              # Docker é…ç½®
â”œâ”€â”€ docker-compose.yml      # Docker Compose é…ç½®
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ install.sh             # è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼ˆå¤„ç†ä»£ç†é…ç½®ï¼‰
â”œâ”€â”€ server.py              # MCP æœåŠ¡å™¨ + HTTP API
â”œâ”€â”€ tools.py               # å·¥å…·å®šä¹‰
â”œâ”€â”€ models/                # æ¨¡å‹æ–‡ä»¶ç›®å½•ï¼ˆVolume æŒ‚è½½ï¼‰
â””â”€â”€ README.md              # ä½¿ç”¨è¯´æ˜
```

## æŠ€æœ¯æ ˆ

- **MCP æ¡†æ¶**: è‡ªå®šä¹‰å®ç°ï¼ˆåŸºäºå·¥å…·è°ƒç”¨æ¨¡å¼ï¼‰
- **AI æ¨¡å‹**: Qwen2-1.5B-Instruct-GGUFï¼ˆå¯é€‰ï¼‰
- **æ¨ç†å¼•æ“**: llama-cpp-pythonï¼ˆçœŸå®æ¨¡å¼ï¼‰/ æ¨¡å¼åŒ¹é…ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
- **åŒ…ç®¡ç†**: uvï¼ˆå¿«é€Ÿ Python åŒ…ç®¡ç†å™¨ï¼‰
- **Web æ¡†æ¶**: Flask
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ä»£ç†å¤„ç†**: è‡ªåŠ¨ä»£ç†é…ç½®è„šæœ¬

## æ¨¡å‹ä¿¡æ¯

- **æ¨¡å‹**: Qwen2-1.5B-Instruct
- **å‚æ•°é‡**: 1.5B
- **é‡åŒ–**: Q4_K_M (çº¦1.2GB)
- **æ”¯æŒ**: ä¸­è‹±æ–‡ã€å·¥å…·è°ƒç”¨
- **æ¨ç†**: CPU æ¨ç†ï¼Œæ— éœ€ GPU

## è¿è¡Œæ¨¡å¼

### æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
é¡¹ç›®é»˜è®¤è¿è¡Œåœ¨**æ¨¡æ‹Ÿæ¨¡å¼**ä¸‹ï¼Œæ— éœ€ä¸‹è½½æ¨¡å‹æ–‡ä»¶å³å¯ä½“éªŒåŠŸèƒ½ï¼š
- âœ… æ”¯æŒæ‰€æœ‰è®¡ç®—å·¥å…·ï¼ˆaddã€multiplyã€calculateï¼‰
- âœ… é€šè¿‡ç®€å•çš„æ¨¡å¼åŒ¹é…è¯†åˆ«è®¡ç®—è¯·æ±‚
- âœ… å¿«é€Ÿå“åº”ï¼Œé€‚åˆæ¼”ç¤ºå’Œæµ‹è¯•
- âš ï¸ ä¸æ”¯æŒå¤æ‚çš„è‡ªç„¶è¯­è¨€ç†è§£

### çœŸå®æ¨¡å‹æ¨¡å¼
è¦ä½¿ç”¨çœŸå®çš„ Qwen2 æ¨¡å‹ï¼š
1. ä¸‹è½½æ¨¡å‹æ–‡ä»¶åˆ° `./models/` ç›®å½•
2. ä¿®æ”¹ `server.py` ä¸­çš„ `load_model()` å‡½æ•°
3. é‡æ–°æ„å»ºå®¹å™¨

## æ³¨æ„äº‹é¡¹

1. **æ¨¡æ‹Ÿæ¨¡å¼**: æ— éœ€ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œå¯ç›´æ¥ä½“éªŒåŠŸèƒ½
2. **çœŸå®æ¨¡å¼**: é¦–æ¬¡å¯åŠ¨éœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆçº¦1.2GBï¼‰ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
3. **å†…å­˜è¦æ±‚**: å»ºè®®åœ¨ 64GB å†…å­˜ç¯å¢ƒä¸‹è¿è¡Œä»¥è·å¾—æœ€ä½³æ€§èƒ½
4. **ä»£ç†ç¯å¢ƒ**: ä¼ä¸šç½‘ç»œç¯å¢ƒéœ€è¦é…ç½®ä»£ç†ï¼Œè¯¦è§æ„å»ºè¯´æ˜

## å¤§æ¨¡å‹ä½¿ç”¨åŸç†

### 1. æ¨¡å‹åŠ è½½
```python
llm = Llama(
    model_path=model_path,  # Qwen2-1.5B GGUFæ–‡ä»¶
    n_ctx=2048,            # ä¸Šä¸‹æ–‡é•¿åº¦2048 tokens
    n_threads=4,           # ä½¿ç”¨4ä¸ªCPUçº¿ç¨‹
    verbose=False
)
```

### 2. ç³»ç»Ÿæç¤ºæ„å»º
å¤§æ¨¡å‹è¢«"æ•™å¯¼"å¦‚ä½•ä½¿ç”¨å·¥å…·ï¼š
- å‘Šè¯‰æ¨¡å‹å®ƒæ˜¯ä¸€ä¸ªæ•°å­¦è®¡ç®—åŠ©æ‰‹
- åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·ï¼ˆaddã€multiplyã€calculateï¼‰
- æŒ‡å®šå·¥å…·è°ƒç”¨çš„JSONæ ¼å¼

### 3. å¯¹è¯å¤„ç†æµç¨‹
å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼š

#### a) æ„å»ºå¯¹è¯æ¶ˆæ¯
```python
messages = [
    {"role": "system", "content": system_prompt},  # ç³»ç»Ÿè§’è‰²ï¼šå®šä¹‰è¡Œä¸º
    {"role": "user", "content": user_message}      # ç”¨æˆ·è§’è‰²ï¼šå…·ä½“é—®é¢˜
]
```

#### b) è°ƒç”¨å¤§æ¨¡å‹
```python
response = llm.create_chat_completion(
    messages=messages,
    temperature=0.1,    # ä½æ¸©åº¦ï¼Œæ›´ç¡®å®šæ€§çš„è¾“å‡º
    max_tokens=512      # é™åˆ¶è¾“å‡ºé•¿åº¦
)
```

### 4. å·¥å…·è°ƒç”¨è§£æä¸æ‰§è¡Œ
å¤§æ¨¡å‹è¿”å›çš„å†…å®¹ä¼šè¢«è§£æï¼š

1. **æ£€æµ‹å·¥å…·è°ƒç”¨**ï¼šæŸ¥æ‰¾ ````json` æ ¼å¼çš„å·¥å…·è°ƒç”¨
2. **è§£æJSON**ï¼šæå–å·¥å…·åå’Œå‚æ•°
3. **æ‰§è¡Œå·¥å…·**ï¼šè°ƒç”¨å¯¹åº”çš„è®¡ç®—å‡½æ•°
4. **è¿”å›ç»“æœ**ï¼šå°†è®¡ç®—ç»“æœè¿”å›ç»™ç”¨æˆ·

### 5. å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

å½“ç”¨æˆ·å‘é€ `"è®¡ç®— 25 + 17"` æ—¶ï¼š

1. **å¤§æ¨¡å‹åˆ†æ**ï¼šç†è§£ç”¨æˆ·éœ€è¦åŠ æ³•è¿ç®—
2. **ç”Ÿæˆå·¥å…·è°ƒç”¨**ï¼š
   ```json
   {"tool": "add", "arguments": {"a": 25, "b": 17}}
   ```
3. **è§£æå¹¶æ‰§è¡Œ**ï¼šè°ƒç”¨ `add(25, 17)` å‡½æ•°
4. **è¿”å›ç»“æœ**ï¼š`"è®¡ç®—ç»“æœ: 42"`

### 6. å…³é”®ç‰¹ç‚¹

- **æœ¬åœ°æ¨ç†**ï¼šæ¨¡å‹å®Œå…¨åœ¨æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œ
- **CPUä¼˜åŒ–**ï¼šä½¿ç”¨ llama.cpp è¿›è¡Œé«˜æ•ˆçš„CPUæ¨ç†
- **å·¥å…·é›†æˆ**ï¼šå¤§æ¨¡å‹å¯ä»¥æ™ºèƒ½é€‰æ‹©å’Œä½¿ç”¨é¢„å®šä¹‰å·¥å…·
- **å¯¹è¯å¼**ï¼šæ”¯æŒå¤šè½®å¯¹è¯ï¼Œä¿æŒä¸Šä¸‹æ–‡

è¿™ç§è®¾è®¡è®©å¤§æ¨¡å‹ä¸ä»…èƒ½å¤Ÿç†è§£å’Œç”Ÿæˆæ–‡æœ¬ï¼Œè¿˜èƒ½ä¸»åŠ¨è°ƒç”¨å·¥å…·æ¥æ‰§è¡Œå…·ä½“çš„è®¡ç®—ä»»åŠ¡ï¼Œå®ç°äº†"æ€è€ƒ+è¡ŒåŠ¨"çš„æ™ºèƒ½åŠ©æ‰‹æ¨¡å¼ã€‚

## æ•…éšœæ’é™¤

### ä»£ç†ç›¸å…³é—®é¢˜
å¦‚æœåœ¨ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­é‡åˆ°è¿æ¥é—®é¢˜ï¼š

1. **ç¡®è®¤ä»£ç†è®¾ç½®**ï¼š
   ```bash
   echo $http_proxy
   echo $https_proxy
   ```

2. **æ£€æŸ¥ä»£ç†è¿é€šæ€§**ï¼š
   ```bash
   curl -I --proxy $http_proxy https://pypi.org
   ```

3. **é‡æ–°æ„å»º**ï¼š
   ```bash
   docker-compose build --no-cache --build-arg http_proxy=$http_proxy --build-arg https_proxy=$https_proxy
   ```

### æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
- **æ¨¡æ‹Ÿæ¨¡å¼**ï¼šæ— éœ€æ¨¡å‹æ–‡ä»¶ï¼Œå¯ç›´æ¥è¿è¡Œ
- **çœŸå®æ¨¡å¼**ï¼šç¡®ä¿æ¨¡å‹æ–‡ä»¶å·²æ­£ç¡®ä¸‹è½½åˆ° `./models/` ç›®å½•ä¸‹

### å†…å­˜ä¸è¶³
å¦‚æœé‡åˆ°å†…å­˜ä¸è¶³ï¼Œå¯ä»¥å°è¯•ï¼š
- å‡å°‘ `n_ctx` å‚æ•°ï¼ˆåœ¨ server.py ä¸­ï¼‰
- ä½¿ç”¨æ›´å°çš„é‡åŒ–ç‰ˆæœ¬æ¨¡å‹
- ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆæ— éœ€æ¨¡å‹æ–‡ä»¶ï¼‰

### ç«¯å£å†²çª
å¦‚æœ 8000 ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥åœ¨ `docker-compose.yml` ä¸­ä¿®æ”¹ç«¯å£æ˜ å°„ã€‚

### æ„å»ºå¤±è´¥
å¦‚æœ Docker æ„å»ºå¤±è´¥ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®
3. å°è¯•æ¸…ç† Docker ç¼“å­˜ï¼š`docker system prune -a`
4. ä½¿ç”¨ `--no-cache` é‡æ–°æ„å»º
